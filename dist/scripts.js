!function(){"use strict";var e=class{constructor(){this.spinner=document.getElementById("loadingSpinner"),this.autocompleteElement=document.getElementById("autocompleteField"),this.addressFieldsElement=document.getElementById("addressFields"),this.countryInputField=document.getElementById("country_field")}setLoading(e){this.spinner&&(this.spinner.style.display=e?"inline-block":"none")}toggleAutocompleteVisibility(e){this.autocompleteElement&&(this.autocompleteElement.style.display=e?"block":"none")}toggleAddressFieldsVisibility(e){this.addressFieldsElement&&(this.addressFieldsElement.style.display=e?"block":"none")}toggleCountryInputVisibility(e){this.countryInputField&&(this.countryInputField.style.display=e?"block":"none")}setFieldReadonly(e,t){const s=document.getElementById(e);s&&(s.readOnly=t)}fillAddressFields(e){const t=document.getElementById("postalcode_field");t&&(t.value=e.postalcode||"");const s=document.getElementById("housenumber_field");s&&(s.value=e.number||"");const i=document.getElementById("housenumberAddition_field");i&&(i.value=e.numberAddition||"");const n=document.getElementById("street_field");n&&(n.value=e.street||"");const l=document.getElementById("city_field");l&&(l.value=e.city||"")}clearValidationErrors(){document.querySelectorAll(".wpcf7-not-valid-tip").forEach((e=>{e.remove()})),document.querySelectorAll(".wpcf7-not-valid").forEach((e=>{e.classList.remove("wpcf7-not-valid")}))}},t=function(e,t,s,i){return new(s||(s=Promise))((function(n,l){function r(e){try{a(i.next(e))}catch(e){l(e)}}function o(e){try{a(i.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}a((i=i.apply(e,t||[])).next())}))},s=class{constructor(e){this.API_ENDPOINT=apicheckcontactform_params.ajax_url,this.COUNTRY_CODE=e}validateEmail(e){return t(this,void 0,void 0,(function*(){try{const t=new FormData;t.append("action","apicheckcontactform_email_validation_call"),t.append("email",e);const s=yield fetch(apicheckcontactform_params.ajax_url,{method:"POST",credentials:"same-origin",body:t});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return(yield s.json()).data}catch(e){return console.error("Error in validateEmail:",e),null}}))}doLookup(e,s){return t(this,void 0,void 0,(function*(){try{const t=new FormData;t.append("action","apicheckcontactform_lookup_call"),t.append("country",this.COUNTRY_CODE),t.append("postalcode",e),t.append("number",s);const i=yield fetch(apicheckcontactform_params.ajax_url,{method:"POST",credentials:"same-origin",body:t});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return(yield i.json()).data}catch(e){return console.error("Error in doLookup:",e),null}}))}doGlobalSearch(e){return t(this,void 0,void 0,(function*(){try{const t=new FormData;t.append("action","apicheckcontactform_search_call"),t.append("searchType","global"),t.append("country",this.COUNTRY_CODE),t.append("query",e);const s=yield fetch(apicheckcontactform_params.ajax_url,{method:"POST",credentials:"same-origin",body:t});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return(yield s.json()).data.data}catch(e){return console.error("Error in doGlobalSearch:",e),null}}))}fetchStreets(e,s,i){return t(this,void 0,void 0,(function*(){try{const t=new FormData;t.append("action","apicheckcontactform_search_call"),t.append("searchType","street"),t.append("country",this.COUNTRY_CODE),t.append("name",e),t.append("city_id",s.toString()),void 0!==i&&t.append("postalcode_id",i.toString());const n=yield fetch(apicheckcontactform_params.ajax_url,{method:"POST",credentials:"same-origin",body:t});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const l=yield n.json();return l.error?(console.error("Error in fetchStreets:",l.error),null):l.data.data}catch(e){return console.error("Caught error in fetchStreets:",e),null}}))}fetchAddresses(e){return t(this,void 0,void 0,(function*(){try{const t=new FormData;t.append("action","apicheckcontactform_search_call"),t.append("searchType","address"),t.append("country",this.COUNTRY_CODE),void 0!==e.street_id&&t.append("street_id",e.street_id.toString()),void 0!==e.postalcode_id&&t.append("postalcode_id",e.postalcode_id.toString()),void 0!==e.city_id&&t.append("city_id",e.city_id.toString()),void 0!==e.number&&t.append("number",e.number.toString());const s=yield fetch(apicheckcontactform_params.ajax_url,{method:"POST",credentials:"same-origin",body:t});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=yield s.json();return i.error?(console.error("Error in fetchAddresses:",i.error),null):i.data.data}catch(e){return console.error("Caught error in fetchAddresses:",e),null}}))}},i={DEFAULT_COUNTRY_CODE:"nl",DEBOUNCE_DELAY:500,AUTOCOMPLETE_COUNTRIES:["de","cz","fi","it","no","pl","pt","ro","es","ch","at","dk","gb","se","fr","be"],LOOKUP_COUNTRIES:["nl","lu"]},n=window.wp.i18n,l=class{constructor(t){if(this.prefilledText="",this.handleKeyUp=e=>{this.handleKeyUpDebouncedCallback(e,i.DEBOUNCE_DELAY)},this.handleKeyUpDebouncedCallback=this.debounce((e=>{let t=e.target.value;if(this.helperService.setLoading(!0),void 0!==this.currentSearchType){if("city"===this.currentSearchType.type&&(this.prefilledText&&t.startsWith(this.prefilledText)&&(t=t.slice(this.prefilledText.length)),this.apiService.fetchStreets(t,this.currentSearchType.data.city_id).then((e=>{this.helperService.setLoading(!1),this.displayPostalcodeResults(e)}))),"postalcode"===this.currentSearchType.type&&(this.prefilledText&&t.startsWith(this.prefilledText)&&(t=t.slice(this.prefilledText.length)),this.apiService.fetchStreets(t,this.currentSearchType.data.City.city_id,this.currentSearchType.data.postalcode_id).then((e=>{this.helperService.setLoading(!1),this.displayPostalcodeResults(e)}))),"street"===this.currentSearchType.type){this.prefilledText&&t.startsWith(this.prefilledText)&&(t=t.slice(this.prefilledText.length));const e=t.trim()?Number(t.replace(/\D/g,"")):void 0;this.apiService.fetchAddresses({street_id:this.currentSearchType.data.street_id,postalcode_id:this.currentSearchType.data.Postalcode.postalcode_id,number:e}).then((e=>{this.helperService.setLoading(!1),this.displayStreetResults(e)}))}if("street-extended"===this.currentSearchType.type){this.prefilledText&&t.startsWith(this.prefilledText)&&(t=t.slice(this.prefilledText.length));const e=t.trim()?Number(t.replace(/\D/g,"")):void 0;this.apiService.fetchAddresses({street_id:this.currentSearchType.data.street_id,city_id:this.currentSearchType.data.City.city_id,number:e}).then((e=>{this.helperService.setLoading(!1),this.displayStreetResults(e)}))}}else this.apiService.doGlobalSearch(t).then((e=>{this.helperService.setLoading(!1),this.displayGlobalResults(e)}))}),i.DEBOUNCE_DELAY),this.handleSearchInputChange=()=>{this.searchInput&&this.clearSearchButton&&(this.searchInput.value.length>0?this.clearSearchButton.style.display="block":(this.clearSearchButton.style.display="none",this.hideResults()))},this.helperService=new e,this.apiService=new s(t),this.searchInput=document.getElementById("search"),this.clearSearchButton=document.getElementById("clearSearchButton"),this.resultsContainer=document.getElementById("results"),this.resultsElement=document.getElementById("results"),this.manualEntry=document.getElementById("manualEntry"),this.manualEntry=document.getElementById("manualEntry"),this.searchInput&&(this.searchInput.addEventListener("input",this.handleSearchInputChange),this.searchInput.addEventListener("keyup",this.handleKeyUp)),this.clearSearchButton&&this.clearSearchButton.addEventListener("click",(()=>{this.currentSearchType=void 0,this.searchInput.value="",this.clearSearchButton.style.display="none",this.helperService.toggleAddressFieldsVisibility(!1),this.hideResults()})),this.manualEntry){const e=this;this.manualEntry.addEventListener("click",(()=>{e.handleManualEntryClick()}))}document.addEventListener("click",(e=>{var t;if(void 0===this.currentSearchType){const s=e.target;this.searchInput===s||(null===(t=this.resultsContainer)||void 0===t?void 0:t.contains(s))||this.hideResults()}})),this.bindEvents()}debounce(e,t){let s;return function(...i){clearTimeout(s),s=setTimeout((()=>e.apply(this,i)),t)}}hideResults(){this.resultsContainer&&(this.resultsContainer.style.display="none")}handleManualEntryClick(){this.helperService.toggleAutocompleteVisibility(!1),this.helperService.toggleAddressFieldsVisibility(!0)}handleSelection(e){const{type:t,data:s}=e;switch(this.currentSearchType=e,t){case"street":this.searchInput&&(this.prefilledText=`${s.City.name}, ${s.name}, `,this.searchInput.value=`${s.City.name}, ${s.name}, `),this.apiService.fetchAddresses({street_id:s.street_id,postalcode_id:s.Postalcode.postalcode_id}).then((e=>{this.displayStreetResults(e)}));break;case"street-extended":this.searchInput&&(this.prefilledText=`${s.City.name}, ${s.name}, `,this.searchInput.value=`${s.City.name}, ${s.name}, `),this.apiService.fetchAddresses({city_id:s.City.city_id,street_id:s.street_id}).then((e=>{this.displayStreetResults(e)}));break;case"postalcode":this.searchInput&&(this.prefilledText=`${s.City.name}, ${s.name}, `,this.searchInput.value=`${s.City.name}, ${s.name}, `),this.apiService.fetchStreets("",s.City.city_id,s.postalcode_id).then((e=>{this.displayPostalcodeResults(e)}));break;case"city":this.searchInput&&(this.prefilledText=`${s.name}, `,this.searchInput.value=`${s.name}, `),this.apiService.fetchStreets("",s.city_id,s.postalcode_id).then((e=>{this.displayPostalcodeResults(e)}));break;case"residence":this.resultsContainer&&(this.resultsContainer.style.display="block"),this.resultsElement&&(this.resultsElement.innerHTML=""),this.searchInput&&(this.searchInput.value=`${s.formattedAddress}`),this.helperService.fillAddressFields(s),this.helperService.toggleAddressFieldsVisibility(!0),this.helperService.clearValidationErrors()}}displayGlobalResults(e){if(!this.resultsElement)return;if(this.resultsElement.innerHTML="",!e)return this.helperService.toggleAutocompleteVisibility(!1),void this.helperService.toggleAddressFieldsVisibility(!0);if(e&&0===e.Results.Cities.length&&0===e.Results.Postalcodes.length&&0===e.Results.Streets.length&&0===e.Results.Residences.length)return void this.addItemToResults((0,n.__)("Er zijn geen resultaten gevonden. Probeer een andere zoekopdracht","apicheck-contactform"),null,!0);function t(e,t){if("string"==typeof e&&t){const s=new RegExp(`(${t})`,"gi");return e.replace(s,'<span class="highlight">$1</span>')}return String(e)}if(!this.searchInput)return;const s=this.searchInput.value;if(e.Results.Streets&&e.Results.Streets.length){this.addHeadingToResults("Straten");for(const i of e.Results.Streets){const e=`${t(i.name,s)}, ${t(i.City.name,s)}, ${i.Postalcode.name}`;this.addItemToResults(e,{type:"street",data:i})}}if(e.Results.Postalcodes&&e.Results.Postalcodes.length){this.addHeadingToResults("Postcodes");for(const i of e.Results.Postalcodes){const e=`${t(i.name,s)}, ${i.City.name}`;this.addItemToResults(e,{type:"postalcode",data:i})}}if(e.Results.Cities&&e.Results.Cities.length){this.addHeadingToResults("Plaatsen");for(const i of e.Results.Cities){const e=t(i.name,s);this.addItemToResults(e,{type:"city",data:i})}}if(e.Results.Residences&&e.Results.Residences.length){this.addHeadingToResults("Adressen");for(const i of e.Results.Residences){const e=t(i.street,s),n=t(i.city,s),l=`${e} ${i.number}, ${n} ${i.postalcode}`;this.addItemToResults(l,{type:"residence",data:i})}}}displayStreetResults(e){if(this.resultsContainer&&this.resultsElement){if(this.resultsContainer.style.display="block",this.resultsElement.innerHTML="",!e)return this.helperService.toggleAutocompleteVisibility(!1),void this.helperService.toggleAddressFieldsVisibility(!0);if(0===e.Results.length)this.addItemToResults((0,n.__)("Er zijn geen adressen gevonden","apicheck-contactform"),null,!0);else{this.addHeadingToResults("Adressen");for(const t of e.Results){const e=`${t.city}, ${t.street} <b>${t.number}</b>`;this.addItemToResults(e,{type:"residence",data:t})}}}}displayPostalcodeResults(e){if(this.resultsContainer&&this.resultsElement&&e)if(this.resultsContainer.style.display="block",this.resultsElement.innerHTML="",0!==e.Results.length){if(this.addHeadingToResults("Straten"),e.Results)for(const t of e.Results){const e=`${t.City.name}, ${t.name}`;this.addItemToResults(e,{type:"street-extended",data:t},!0)}}else this.addItemToResults("Er zijn geen straten gevonden",null,!0)}addItemToResults(e,t,s){if(!this.resultsElement)return;const i=document.createElement("div");i.innerHTML=e,i.className="suggestion-item",s&&(i.className+=" disabled-item"),t&&(i.dataset.jsonData=JSON.stringify(t)),this.resultsElement.appendChild(i)}addHeadingToResults(e){if(!this.resultsElement)return;const t=document.createElement("div");t.textContent=e,t.className="group-heading",this.resultsElement.appendChild(t)}bindEvents(){this.searchInput&&this.searchInput.addEventListener("keyup",(e=>this.handleSearchInputKeyUp(e))),this.resultsContainer&&this.resultsContainer.addEventListener("click",(e=>this.handleResultItemClick(e))),document.addEventListener("click",(e=>this.handleDocumentClick(e)))}handleSearchInputKeyUp(e){this.searchInput&&(""!==this.searchInput.value.trim()?(this.showResults(),this.handleKeyUp(e)):this.hideResults())}handleResultItemClick(e){const t=e.target;if(t.classList.contains("suggestion-item")){const e=JSON.parse(t.dataset.jsonData||"{}");this.handleSelection(e),this.hideResults()}}handleDocumentClick(e){const t=e.target;this.searchInput&&this.resultsContainer&&!this.resultsContainer.contains(t)&&this.hideResults()}showResults(){this.resultsContainer&&(this.resultsContainer.style.display="block")}destroy(){this.searchInput&&(this.searchInput.removeEventListener("input",this.handleSearchInputChange),this.searchInput.removeEventListener("keyup",this.handleKeyUp)),this.manualEntry&&this.manualEntry.removeEventListener("click",this.handleManualEntryClick),document.removeEventListener("click",this.handleDocumentClick),this.helperService=null,this.searchInput=null,this.clearSearchButton=null,this.resultsContainer=null,this.resultsElement=null,this.currentSearchType=void 0}},r=class{constructor(t){var i,n;this.bothFieldsFilled=!1,this.handleLookupResponse=e=>{e&&(e.error?this.handleErrorResult(e):this.handleSuccessResult(e))},this.helperService=new e,this.apiService=new s(t),this.updateBothFieldsFilled=this.updateBothFieldsFilled.bind(this),this.postalcodeInput=document.getElementById("postalcode_field"),this.housenumberInput=document.getElementById("housenumber_field"),this.streetInput=document.getElementById("street_field"),this.cityInput=document.getElementById("city_field"),this.noAddressFoundMessage=document.getElementById("noAddressFoundMessage"),null===(i=this.postalcodeInput)||void 0===i||i.addEventListener("input",this.updateBothFieldsFilled),null===(n=this.housenumberInput)||void 0===n||n.addEventListener("input",this.updateBothFieldsFilled)}updateBothFieldsFilled(){var e,t,s;if(this.bothFieldsFilled=!(!(null===(e=this.postalcodeInput)||void 0===e?void 0:e.value.trim())||!(null===(t=this.housenumberInput)||void 0===t?void 0:t.value.trim())),!this.bothFieldsFilled)return null===(s=this.noAddressFoundMessage)||void 0===s||s.style.setProperty("display","none"),void this.resetLookupTimer();this.lookupDebounce()}resetLookupTimer(){this.lookupDebounceTimer&&clearTimeout(this.lookupDebounceTimer)}lookupDebounce(){clearTimeout(this.lookupDebounceTimer),this.lookupDebounceTimer=setTimeout((()=>{this.postalcodeInput&&this.housenumberInput&&this.apiService.doLookup(this.postalcodeInput.value,this.housenumberInput.value).then((e=>this.handleLookupResponse(e))).catch((e=>console.error("Lookup failed:",e)))}),i.DEBOUNCE_DELAY)}handleErrorResult(e){if(this.noAddressFoundMessage)switch(e.name){case"invalid_postalcode_format":this.noAddressFoundMessage.textContent="Dit is geen geldige postcode",this.noAddressFoundMessage.style.backgroundColor="#e89f00",this.noAddressFoundMessage.style.display="block";break;case"no_match":this.noAddressFoundMessage.textContent="Er is geen adres gevonden met deze postcode en huisnummer. Controleer of de gegevens juist zijn ingevuld en vul handmatig aan.",this.noAddressFoundMessage.style.backgroundColor="#f44336",this.noAddressFoundMessage.style.display="block",this.helperService.setFieldReadonly("street",!1),this.helperService.setFieldReadonly("city",!1)}}handleSuccessResult(e){var t,s,i,n;this.streetInput&&this.cityInput&&this.postalcodeInput&&(this.streetInput.value=(null===(t=e.data)||void 0===t?void 0:t.street)||"",this.cityInput.value=(null===(s=e.data)||void 0===s?void 0:s.city)||"",this.postalcodeInput.value=(null===(i=e.data)||void 0===i?void 0:i.postalcode)||"",this.helperService.clearValidationErrors()),null===(n=this.noAddressFoundMessage)||void 0===n||n.style.setProperty("display","none")}destroy(){var e,t;null===(e=this.postalcodeInput)||void 0===e||e.removeEventListener("input",this.updateBothFieldsFilled),null===(t=this.housenumberInput)||void 0===t||t.removeEventListener("input",this.updateBothFieldsFilled),this.lookupDebounceTimer&&clearTimeout(this.lookupDebounceTimer),this.helperService=null,this.postalcodeInput=null,this.housenumberInput=null,this.streetInput=null,this.cityInput=null,this.noAddressFoundMessage=null,this.lookupDebounceTimer=void 0}},o=class{constructor(e){this.apiService=new s(e);const t=this.findAllEmailInputs();this.listenToEmailInputs(t)}findAllEmailInputs(){const e=document.querySelectorAll('input[type="email"]'),t=[];return e.forEach((e=>{const s=e.closest("form");s&&s.querySelector("#country_input_field")&&t.push(e)})),t}debounceEmailInput(e,t){let s;return function(){clearTimeout(s),s=setTimeout(e,t)}}handleEmailInputChange(e){var t;const s=document.createElement("div");/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(e.value)?this.apiService.validateEmail(e.value).then((e=>{"valid"===(null==e?void 0:e.data.status)?(s.className="noAddressFoundMessage",s.id="noAddressFoundMessage",s.style.color="green",s.textContent="Dit is een geldig e-mailadres"):(s.className="noAddressFoundMessage",s.id="noAddressFoundMessage",s.style.color="#dc3232",s.textContent="Weet je zeker dat dit een geldig e-mailadres is?")})):(s.className="noAddressFoundMessage",s.id="noAddressFoundMessage",s.style.color="#dc3232",s.textContent="Dit is geen geldig e-mailadres");const i=e.nextElementSibling;i&&"noAddressFoundMessage"===i.id&&i.remove(),null===(t=e.parentNode)||void 0===t||t.insertBefore(s,e.nextSibling)}listenToEmailInputs(e){e.forEach((e=>{const t=this.debounceEmailInput((()=>this.handleEmailInputChange(e)),500);e.addEventListener("input",(e=>{t()}))}))}};let a="",d=null,c=null;document.addEventListener("DOMContentLoaded",(()=>{!function(){const t=new e,s=document.getElementById("countryDropdown"),n=document.getElementById("country_input_field"),u=null==s?void 0:s.querySelector(".select-selected"),h=null==s?void 0:s.querySelector(".select-items"),p=null==h?void 0:h.querySelectorAll("li");if(document.getElementById("apicheckaddressfields")&&new o(a),!(s&&u&&h&&p))return void console.error("One or more dropdown elements are missing!");u.addEventListener("click",(()=>h.classList.toggle("show"))),p.forEach((e=>{e.addEventListener("click",(()=>{v(e),h.classList.remove("show")}))})),document.addEventListener("click",(e=>{s.contains(e.target)||h.classList.remove("show")}));const m=i.DEFAULT_COUNTRY_CODE,y=h.querySelector(`li[data-value="${m}"]`);if(y){y.setAttribute("data-selected","true"),v(y);const e=g(i.DEFAULT_COUNTRY_CODE);n.value=null!==e?e:""}else{const e=h.querySelector("li[data-value]:first-child");if(e){e.setAttribute("data-selected","true"),v(e);const t=g(e.getAttribute("data-value"));n.value=null!==t?t:""}}function v(e){u.innerHTML=e.innerHTML;const s=e.getAttribute("data-value")||"";s?(n.value=g(s)||"",a=s,i.AUTOCOMPLETE_COUNTRIES.includes(s)?(t.toggleCountryInputVisibility(!1),function(e){document.getElementById("noAddressFoundMessage").style.display="none",t.toggleAutocompleteVisibility(!0),t.toggleAddressFieldsVisibility(!1),t.setFieldReadonly("street",!1),t.setFieldReadonly("city",!1),d&&(d.destroy(),d=null),d=new l(e)}(s)):i.LOOKUP_COUNTRIES.includes(s)?(t.toggleCountryInputVisibility(!1),function(e){t.toggleAutocompleteVisibility(!1),t.toggleAddressFieldsVisibility(!0),t.setFieldReadonly("street",!0),t.setFieldReadonly("city",!0),c&&(c.destroy(),c=null),c=new r(e)}(s)):(t.toggleAutocompleteVisibility(!1),t.toggleAddressFieldsVisibility(!0),t.toggleCountryInputVisibility(!0),t.setFieldReadonly("street",!1),t.setFieldReadonly("city",!1))):console.error('Selected element does not have a "data-value" attribute.')}function g(e){const t=document.querySelector(`li[data-value="${e}"]`);if(t){const e=t.querySelector("span[data-country-name]");if(e)return e.dataset.countryName||null}return null}}()})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("#postalcode_field"),t=document.querySelector("#street_field"),s=document.querySelector("#city_field"),i=document.querySelector("#housenumber_field");function n(e,t){e.classList.add("wpcf7-not-valid");const s=document.createElement("span");s.className="wpcf7-not-valid-tip",s.setAttribute("aria-hidden","true"),s.textContent=t,e.insertAdjacentElement("afterend",s)}document.querySelectorAll(".wpcf7-form").forEach((l=>{l.addEventListener("submit",(l=>{document.querySelectorAll(".wpcf7-not-valid-tip").forEach((e=>{e.remove()})),document.querySelectorAll(".wpcf7-not-valid").forEach((e=>{e.classList.remove("wpcf7-not-valid")}));const r=e?e.value.trim():"",o=t?t.value.trim():"",a=s?s.value.trim():"",d=i?i.value.trim():"";let c=!0;!r&&e&&e.hasAttribute("required")&&(c=!1,n(e,"Postcode is verplicht.")),!o&&t&&t.hasAttribute("required")&&(c=!1,n(t,"Straat is verplicht.")),!a&&s&&s.hasAttribute("required")&&(c=!1,n(s,"Stad is verplicht.")),!d&&i&&i.hasAttribute("required")&&(c=!1,n(i,"Huisnummer is verplicht.")),c||l.preventDefault()}))}))}))}();